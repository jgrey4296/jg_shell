<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: browser/webMain.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: browser/webMain.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
   The main web program that runs the web interface
   @module Browser/WebMain
 */

//Setup requirejs
//For soe server: baseUrl -> /~jgrey/src
//and libs -> /~jgrey/libs
require.config({
    baseUrl: "/src",
    paths:{
        //General Utils
        underscore : "/libs/underscore-min",
        //uContrib : "/libs/underscore-contrib.min",
        utils : "utils",
        d3 : "/libs/d3.min",
        Parse : "Parse/Parse",
        //Nodes:
        GraphNode : "Node/GraphNode",
        //Commands:
        AllCommands : "Commands/Command_Aggregate",
        //CLI
        HelpCLI : "CLI/HelpCLI",
        MainCommandCLI : "CLI/MainCommandCLI",
        //Shell
        Shell : "Shell",
        //Shell : "/libs/Shell.min",
        //Rete
        Rete : "/libs/Rete.min"
    },
    shim:{
        'underscore' :{
            exports:'_'
        },
    }
});

/**
   @require [d3,Shell,underscore,NodeCommands,RuleCommands,ReteCommands,utils]
   @purpose The main web program. Creates a shell, visualises it, and listens for user input
*/
require(['d3','Shell','underscore',"HelpCLI","MainCommandCLI","AllCommands"],function(d3,Shell,_,HelpCLI,MainCommandCLI,AllCommands){
    "use strict";

    //----------------------------------------
    //GLOBALS
    //----------------------------------------
    var globalData = {
        maxNumberOfNodesInAColumn : 10,
        maxNumberOfChildrenVisible : 40,

        //Command aggregate object stored here, giving interface to commands:
        commands : AllCommands,
        
        //The order that commands will be checked if they arent found in the current mode
        commandFallBackOrder : [
            "node","rule","rete","sim","general","bookmark","trace"
        ],
        
        currentCommandMode : "node",
    
        //The simulated shell:
        shell : new Shell(),

        lastSetOfSearchResults : [],
        lastInspectData : [],
        currentSelection : [],

        
        MainCommandCLIRef : MainCommandCLI,

        
        //COLOURS:
        scaleToColour : d3.scale.linear()
            .range([0,20])
            .domain([0,20]),
        colourScale : d3.scale.category20b(),
        colours : {
            grey : d3.rgb(19,21,27),
            text : d3.rgb(237,255,255),
            textBlue : d3.rgb(98,188,238),
            textGrey : d3.rgb(132,146,154),
            darkBlue : d3.rgb(23,50,77),
            darkerBlue : d3.rgb(20,38,60),
            lightBlue: d3.rgb(53,99,142),
            green : d3.rgb(108,141,7),

            //Specifics?
            //node
            //rule
            //action
            //condition
            //interiorRect1
            //interiorRect2
            //interiorRect3
            regexAction : "rgb(123,23,5)"
            
        },

        //Sizes:
        drawOffset : 50,
        columnHeight : 300,
        columnWidth : 200,
        usableWidth : window.innerWidth - 30,
        usableHeight : window.innerHeight - 30,
        helpSize : 600,

        halfWidth : function(){ return this.usableWidth * 0.5;},
        halfHeight : function(){ return this.usableHeight * 0.5;},
        
        //The main svg:
        svg : null,
        //Columns:
        columns : {},

    //Utility Functions:
        calcWidth : function(availableWidth,noOfColumns){
            return availableWidth / (noOfColumns + 2);
        },

        columnPosition : function(oneColWidth,columnNumber){
            return oneColWidth + (oneColWidth * columnNumber);
        },
   
        getColumnObject : function(columnName){
            if(globalData.columns[columnName] === undefined){
                throw new Error("Unrecognised Column Name: " + columnName);
            }
            return globalData.columns[columnName];
        },

        initColumn : function(name,columnNumber,columnWidth){
            //todo
        },

        lookupOrFallBack : function(commandName,globalData){
            if(globalData === undefined) { globalData = this; }
            var commandToExecute;
            if(globalData.commands[globalData.currentCommandMode]
               &amp;&amp; globalData.commands[globalData.currentCommandMode][commandName]){
                //console.log("Command Search: Found");
                commandToExecute = globalData.commands[globalData.currentCommandMode][commandName];
            }else{        
                //command not found, fallback
                //console.log("Command Search: Fallback");
                var fallBacks = _.clone(globalData.commandFallBackOrder);
                while(fallBacks.length > 0){
                    var currentFallback = fallBacks.shift();
                    if(globalData.commands[currentFallback][commandName] !== undefined){
                        commandToExecute = globalData.commands[currentFallback][commandName];
                    }
                }
            }
            return commandToExecute;
        },

        
    };
    //End of utilities
    //--------------------
    //Set up CLI:
    d3.select("#shellInput").on("keydown",function(err){
        try{
            var currentLine = d3.select(this).node().value;
            if(currentLine.length === 0) { return; }
            
            if(d3.event.keyCode === 13){ //ENTER
                //clear the input:
                d3.select(this).node().value = "";
                MainCommandCLI(currentLine,globalData);
            }else{//Not enter, still typing:
                HelpCLI(currentLine + d3.event.key,globalData);
            }
        }catch(e){
            console.log("Input Error: ",e);
        }
    });

    //----------------------------------------
    //Startup:
    //set focus:
    d3.select("#shellInput").node().focus();
    //Setup the svg:
    globalData.svg = d3.select("body").append("svg")
        .attr("width",globalData.usableWidth)
        .attr("height",globalData.usableHeight)
        .style("background",globalData.colours.grey);

    MainCommandCLI("",globalData);
    
});


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Browser_WebMain.html">Browser/WebMain</a></li><li><a href="module-CLI_HelpCLI.html">CLI/HelpCLI</a></li><li><a href="module-CLI_MainCommandCLI.html">CLI/MainCommandCLI</a></li><li><a href="module-Commands_BookMarkCommands.html">Commands/BookMarkCommands</a></li><li><a href="module-Commands_Command_Aggregate.html">Commands/Command_Aggregate</a></li><li><a href="module-Commands_CommandTemplate.html">Commands/CommandTemplate</a></li><li><a href="module-Commands_GeneralCommands.html">Commands/GeneralCommands</a></li><li><a href="module-Commands_NodeCommands.html">Commands/NodeCommands</a></li><li><a href="module-Commands_ReteCommands.html">Commands/ReteCommands</a></li><li><a href="module-Commands_RuleCommands.html">Commands/RuleCommands</a></li><li><a href="module-Commands_SimulationCommands.html">Commands/SimulationCommands</a></li><li><a href="module-Commands_TraceCommands.html">Commands/TraceCommands</a></li><li><a href="module-Drawing_DrawUtils.html">Drawing/DrawUtils</a></li><li><a href="module-Drawing_GeneralDrawing.html">Drawing/GeneralDrawing</a></li><li><a href="module-Drawing_NodeDrawing.html">Drawing/NodeDrawing</a></li><li><a href="module-Drawing_RuleDrawing.html">Drawing/RuleDrawing</a></li><li><a href="module-Drawing_TraceDrawing.html">Drawing/TraceDrawing</a></li><li><a href="module-Node_Action.html">Node/Action</a></li><li><a href="module-Node_Bookmark.html">Node/Bookmark</a></li><li><a href="module-Node_Condition.html">Node/Condition</a></li><li><a href="module-Node_Constructors.html">Node/Constructors</a></li><li><a href="module-Node_GraphNode.html">Node/GraphNode</a></li><li><a href="module-Node_Institution.html">Node/Institution</a></li><li><a href="module-Node_Rule.html">Node/Rule</a></li><li><a href="module-Parse.html">Parse</a></li><li><a href="module-Shell.html">Shell</a></li><li><a href="module-ShellModule_shell_node_mod.html">ShellModule/shell_node_mod</a></li><li><a href="module-ShellModules_shell_graph_search.html">ShellModules/shell_graph_search</a></li><li><a href="module-ShellModules_shell_json.html">ShellModules/shell_json</a></li><li><a href="module-ShellModules_shell_node_addition.html">ShellModules/shell_node_addition</a></li><li><a href="module-ShellModules_shell_node_deletion.html">ShellModules/shell_node_deletion</a></li><li><a href="module-ShellModules_shell_prototype_extraction.html">ShellModules/shell_prototype_extraction</a></li><li><a href="module-ShellModules_shell_prototype_main.html">ShellModules/shell_prototype_main</a></li><li><a href="module-ShellModules_shell_rete.html">ShellModules/shell_rete</a></li><li><a href="module-ShellModules_shell_search.html">ShellModules/shell_search</a></li><li><a href="module-ShellModules_shell_state_change.html">ShellModules/shell_state_change</a></li><li><a href="module-ShellModules_shell_string.html">ShellModules/shell_string</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-Node_Rule.html">Node/Rule</a></li><li><a href="module-Shell.html">Shell</a></li><li><a href="Node_Action.html">Node/Action</a></li><li><a href="Node_Bookmark.html">Node/Bookmark</a></li><li><a href="Node_Condition.html">Node/Condition</a></li><li><a href="Node_GraphNode.html">Node/GraphNode</a></li><li><a href="Node_Institution.html">Node/Institution</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Feb 28 2016 05:31:58 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
